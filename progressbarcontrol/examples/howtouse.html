<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">


<head>
<title>Google Maps JavaScript API Example - Snap to Polyline</title>
    
<script>
    var scriptTag = '<' + 'script src="http://maps.google.com/maps?file=api&v=2.x&key=ABQIAAAAbRm2TpqQOvF3ceP4wzWXeBRjPdZ0Gi1PU2qzQdsg6xUdJcVS0BSQaZWcYAi4GWkHQIVPn4t32q1Jfw">'+'<'+'/script>';
    document.write(scriptTag);
</script>

<script type="text/javascript" src="scripts/progressbarcontrol.js"></script>

<script type="text/javascript">

var map;
var oProgressBar;

function load() {
    doLoad();
}

function doLoad() {
    if (GBrowserIsCompatible()) {
        map = new GMap2(document.getElementById("map"), {draggableCursor:"crosshair"});
        map.setCenter(new GLatLng(parseFloat(52), parseFloat(4)), 7);
        map.addControl(new GScaleControl());
        map.addControl(new GLargeMapControl());
        map.addControl(new GMapTypeControl());
        
        oProgressBar = new ProgressbarControl(map, {width:150});
    } 
}

// marker array
var aMarkers = [];
var iMax = 200;
var i = 0;    

// Load 25 markers on map
function loadMarkers(){
    oProgressBar.start(iMax);
    setTimeout('createMarker()', 10);
}

// create a marker
function createMarker(){
    i++;
    oProgressBar.updateLoader(1);
    // Add 10 markers to the map at random locations
      var bounds = map.getBounds();
      var southWest = bounds.getSouthWest();
      var northEast = bounds.getNorthEast();
      var lngSpan = northEast.lng() - southWest.lng();
      var latSpan = northEast.lat() - southWest.lat();
      var point = new GLatLng(southWest.lat() + latSpan * Math.random(), southWest.lng() + lngSpan * Math.random());
      
    var marker = new GMarker(point);
    
    aMarkers.push(marker);
    
    map.addOverlay(marker);
    
    if ( i < iMax ) {
        setTimeout('createMarker()', 10);
    } else {
        oProgressBar.remove();
        i = 0;
    }
        
}



function removeMarkers(){
    oProgressBar.start(aMarkers.length);
    setTimeout("removeMarker()", 10);
    
}


function removeMarker(){
    oProgressBar.updateLoader(1);
    map.removeOverlay(aMarkers.pop());
    if ( aMarkers.length > 0 ) {
        setTimeout("removeMarker()", 10);
    } else {
        oProgressBar.remove();
    }
}

</script>
<style media="screen">


</style>
</head>


<body onload="load()" onunload="GUnload()">

    <div id="header" style="color: #FFFFC0; font: normal 14px verdana; padding:3px; margin:10px;">
    <a href="http://www.geostart.nl/">Part of GeoStart</a> (<a href="http://demo.geostart.nl">demo</a>)
    </div>



<div id="msg" style="width: 680px; font: bold 12px verdana;padding:3px;margin:10px;">

<pre>
/**
*   progress class.
*
*   Usage:
*   oProgressbarControl = new ProgressbarControl(oMap, opt_opts);
*   oProgressbarControl.(500); // Amount of operations, unhides the control
*   oProgressbarControl.(iAdded); // Add amount of operations just done
*   oProgressbarControl.(); // Hide the control.
*   
*   opt_opts: Object containing options:
*               {Number} iWidth Width of the control
*               {String} sLoadstring String displayed when first starting the control
*
*   Part of GeoStart (www.geostart.nl)
*   Author: Björn Brala SWIS BV
**/
</pre>
</div>


<table cellspacing="0" cellpadding="0" style="-moz-outline-width:8px; -moz-outline-radius:15px; -moz-outline-style:solid;-moz-outline-color:#838FBB;margin:20px;">
    <tr>
        <td class="menu" width="188">
            <a href="#bottom" onclick="oProgressBar.start(500);">oProgressBar.start(500);</a>
            <a href="#bottom" onclick="oProgressBar.updateLoader(7);">oProgressBar.updateLoader(7);</a>
            <a href="#bottom" onclick="oProgressBar.remove();">oProgressBar.remove();</a>
            <a href="#bottom" onclick="loadMarkers();">loadMarkers();</a>
            <a href="#bottom" onclick="removeMarkers();">removeMarkers();</a>
        </td>
        </tr><tr>
        <td valign="top">
            <div id="map" style="width: 700px; height: 500px"></div>            
            <a title="bottom">
        </td>
    </tr>
</table>

</body>
</html>